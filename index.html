<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>你可以躺平多久计算器</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://fastly.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">你可以躺平多久计算器</h1>
        <form>
            <div class="mb-3">
                <label for="totalAssets" class="form-label">总资产（W）</label>
                <input type="text" pattern="[0-9]+([\.,][0-9]+)?" class="form-control" id="totalAssets" placeholder="请输入您的总资产">
            </div>
            <div class="mb-3">
                <label for="expectedReturn" class="form-label">预期收益 (%)</label>
                <input type="text" pattern="[0-9]+([\.,][0-9]+)?" class="form-control" id="expectedReturn" placeholder="请输入预期年收益率">
            </div>
            <div class="mb-3">
                <label for="annualExpense" class="form-label">首年支出(W)</label>
                <input type="text" pattern="[0-9]+([\.,][0-9]+)?" class="form-control" id="annualExpense" placeholder="请输入每年支出金额">
            </div>
            <div class="mb-3">
                <label for="annualInflation" class="form-label">预期通胀 (%)</label>
                <input type="text" pattern="[0-9]+([\.,][0-9]+)?" class="form-control" id="annualInflation" value="2" >
            </div>
            <button type="submit" class="btn btn-primary">计算</button>
        </form>
        <div id="result" class="mt-4 p-3 bg-light rounded">
            <h4>计算结果</h4>
            <p id="yearsResult">您的资产可以支撑大约 ？ 年 ？ 个月;</p>
            <div id="detailYearsResult" class="mt-3" style="display:none;">
                <h5>每年资产变化</h5>
                <div class="table-responsive">
                    <table id="assetsTable" class="table table-striped table-bordered" >
                        <thead>
                            <tr>
                                <th>年份</th>
                                <th>总资产（W）</th>
                                <th>每年支出（W）</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://fastly.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.querySelector('form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 获取输入值
            const totalAssets = parseFloat(document.getElementById('totalAssets').value);
            const expectedReturn = parseFloat(document.getElementById('expectedReturn').value);
            const firstYearExpense = parseFloat(document.getElementById('annualExpense').value);
            const annualInflation = parseFloat(document.getElementById('annualInflation').value);          
            let currentExpense = firstYearExpense;
            // 计算每年资产变化
            let years = 0;
            let currentAssets = totalAssets;
            const assetsData = [];
            let lastYearAssets = 0;
            
            while(currentAssets > 0 && years<=100) { 
                assetsData.push({
                    year: years + 1,
                    assets: currentAssets.toFixed(2),
                    annualExpense: currentExpense.toFixed(2)
                });
                lastYearAssets = currentAssets;
                currentAssets = (currentAssets * (1 + expectedReturn/100)) - currentExpense;
                currentExpense = currentExpense * (1 + annualInflation/100);
                years++;
            }
            
            // 计算精确月数
            const months =  Math.floor(lastYearAssets* 12 / currentExpense );
            

            if(years>100){
            document.getElementById('yearsResult').textContent = 
                `您的资产可以支撑大约可以用100年以上`;
            }else{
            // 显示结果 
            document.getElementById('yearsResult').textContent = 
                `您的资产可以支撑大约 ${years-1} 年 ${months} 个月`;
            }
            // 生成表格
            const tableBody = document.querySelector('#assetsTable tbody');
            tableBody.innerHTML = '';
            assetsData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>第${item.year-1}年</td>
                    <td>${item.assets}</td>
                    <td>${item.annualExpense}</td>                    
                `;
                tableBody.appendChild(row);
            });
            
            document.getElementById('detailYearsResult').style.display = 'block';
        });
    </script>
</body>
</html>
